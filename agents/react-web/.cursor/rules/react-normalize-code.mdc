---
name: react-normalize-code
description: |
  Agent invoked when the user says "normalize this code", "normalize", or similar.
  First checks that the project has a linter configured (read package.json and ensure scripts.lint exists). If not, stops and suggests the skill react-linter-setup. Then runs react-files-structure-standards, react-coding-standards, then react-single-responsibility sequentially (read each skill's SKILL.md and follow its workflow).
  Re-validates coding standards (step 6), then single-responsibility (step 7); max 2 iterations each.
  Accepts any scope: selected files, git staged files, a branch, selected lines, a directory, or a glob.
allowed-tools: Read, Write, Edit, Grep, Glob, Bash
---

# Normalize Code — Agent

## Trigger phrases

- "normalize this code"
- "normalize"
- "normalize [files / branch / staged / selection]"

---

## Context

This rule applies to a **React and TypeScript** project. It orchestrates three skills; each skill is the source of truth for its own workflow — do not duplicate their content here.

---

## Workflow

1. **Check linter configuration** — Read the project's `package.json` and ensure `scripts.lint` exists. If the linter is **not** configured: **stop the workflow**, do not run steps 2–8, and tell the user that normalization requires a configured linter and suggest using the skill **react-linter-setup** (e.g. "The linter is not configured for this project. Stop here and use the **react-linter-setup** skill to configure ESLint and lint scripts in package.json, then run normalization again."). Only proceed to step 2 if the check passes.

2. **Resolve scope** — Determine the initial set of files in scope (selected files, git staged files, branch, selected lines, directory, or glob). Maintain a **current scope** for the whole run: start with this initial set, and **add to it every file you create or modify** during the workflow (steps 3–5), e.g. renamed paths, new sub-components, or any file touched by the skills. Steps 3, 4, and 5 always run on the **current scope**. Whenever you create or modify a file, add it to the current scope so that subsequent steps and re-validation (6–7) always consider the full set of files touched by this normalization run.

3. **Run react-files-structure-standards** — Read [skills/react-files-structure-standards/SKILL.md](skills/react-files-structure-standards/SKILL.md) and the reference file it specifies. Execute the skill's full two-phase workflow (Phase 1: collect file/folder violations, Phase 2: rename and update imports) on all paths in the **current scope**. After creating or renaming files, add those paths to the current scope. Do not summarize the skill's workflow in this rule; follow the skill as written.

4. **Run react-coding-standards** — Read [skills/react-coding-standards/SKILL.md](skills/react-coding-standards/SKILL.md) and the reference files it specifies. Execute **every phase** of the skill's workflow in order on all files in the **current scope**. Do not summarize the skill's workflow in this rule; follow the skill as written.

5. **Run react-single-responsibility** — Read [skills/react-single-responsibility/SKILL.md](skills/react-single-responsibility/SKILL.md). Execute the skill's simplification strategies on all files in the **current scope**. After creating new files (e.g. sub-components), add those files to the current scope. Let the skill define decomposition order, structure, and rules; do not repeat them here.

6. **Re-validate coding standards** — Re-run react-coding-standards for **validation only**: execute every phase that **detects or lists** violations (skip phases that **apply corrections**) on all files in the **current scope** (i.e. initial set plus every file created or modified during steps 3–5). Include every file touched by the workflow so that new or modified code is also checked; otherwise violations in those files will not trigger a new iteration.
   - If any violations are found → log them, then go back to step 4 (new iteration).
   - If no violations → proceed to step 7.
   - **Max 2 iterations.** If violations still exist after 2 full cycles, report the remaining issues and stop.

7. **Re-validate single-responsibility** — Re-run the react-single-responsibility criteria (checklists and simplification rules from the skill) on all files in the **current scope** (i.e. initial set plus every file created or modified during steps 3–5). Include every file touched by the workflow so that new or modified code is also checked.
   - If any violations are found → log them, then go back to step 4 (new iteration).
   - If no violations → proceed to the summary.
   - **Max 2 iterations.** If violations still exist after 2 full cycles, report the remaining issues and stop.

8. **Produce the summary** (see Output below).

---

## Output — Summary report

After the final iteration:

```
## Normalize — Summary

**Scope:** <resolved scope>
**Iterations:** <n>

### Changes applied
| File | Change type | Description |
|------|-------------|-------------|
| ...  | Rename / Refactor / Extract / Split | ... |

### Files created
- `path/to/new-file.ts` — reason

### Remaining issues (if max iterations reached)
- ...
```

---

## Rules of thumb (normalize-specific)

- **Never change business logic** — only structure, naming, and patterns.
- **Selected lines scope** — when the user specified lines, restrict all edits to that range.
- **Stop at 2 iterations** — report remaining violations rather than looping beyond 2 cycles.
