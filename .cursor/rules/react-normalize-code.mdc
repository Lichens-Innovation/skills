---
name: react-normalize-code
description: |
  Agent invoked when the user says "normalize this code", "normalize", or similar.
  Runs react-coding-standards then react-single-responsibility sequentially (read each skill's SKILL.md and follow its workflow).
  Re-validates coding standards after simplification; max 2 iterations.
  Accepts any scope: selected files, git staged files, a branch, selected lines, a directory, or a glob.
allowed-tools: Read, Write, Edit, Grep, Glob, Bash
---

# Normalize Code — Agent

## Trigger phrases

- "normalize this code"
- "normalize"
- "normalize [files / branch / staged / selection]"

---

## Context

This rule applies to a **React and TypeScript** project. It orchestrates two skills; each skill is the source of truth for its own workflow — do not duplicate their content here.

---

## Workflow

1. **Resolve scope** — Determine which files are in scope (selected files, git staged files, branch, selected lines, directory, or glob).

2. **Run react-coding-standards** — Read [skills/react-coding-standards/SKILL.md](skills/react-coding-standards/SKILL.md) and the reference files it specifies. Execute the skill's full two-phase workflow (Phase 1: collect violations, Phase 2: apply corrections) on all files in scope. Do not summarize the skill's workflow in this rule; follow the skill as written.

3. **Run react-single-responsibility** — Read [skills/react-single-responsibility/SKILL.md](skills/react-single-responsibility/SKILL.md). Execute the skill's simplification strategies on all files in scope. Let the skill define decomposition order, structure, and rules; do not repeat them here.

4. **Re-validate** — Re-run **Phase 1 only** of react-coding-standards (violation collection) on all files modified in steps 2 and 3.
   - If any violations are found → log them, then go back to step 2 (new iteration).
   - If no violations → normalization is complete. Proceed to the summary.
   - **Max 2 iterations.** If violations still exist after 2 full cycles, report the remaining issues and stop.

5. **Produce the summary** (see Output below).

---

## Output — Summary report

After the final iteration:

```
## Normalize — Summary

**Scope:** <resolved scope>
**Iterations:** <n>

### Changes applied
| File | Change type | Description |
|------|-------------|-------------|
| ...  | Rename / Refactor / Extract / Split | ... |

### Files created
- `path/to/new-file.ts` — reason

### Remaining issues (if max iterations reached)
- ...
```

---

## Rules of thumb (normalize-specific)

- **Never change business logic** — only structure, naming, and patterns.
- **Selected lines scope** — when the user specified lines, restrict all edits to that range.
- **Stop at 2 iterations** — report remaining violations rather than looping beyond 2 cycles.
